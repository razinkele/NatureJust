/* ============================================
   NatureJust-EU Design System
   Aesthetic: "Cartographic Editorial"
   Marine cartography meets typographic governance
   ============================================ */

/* System font stack — eliminates external Google Fonts dependency for offline
   deployment and GDPR compliance. Playfair Display → Georgia serif stack,
   Figtree → system-ui sans-serif stack. */

/* ---------- Design Tokens ---------- */
:root {
  --nj-deep: #0A1628;
  --nj-navy: #132744;
  --nj-ocean: #1B4965;
  --nj-blue: #2A6F97;
  --nj-sky: #5FA8D3;

  --nj-teal: #0E7C7B;
  --nj-seafoam: #81B29A;
  --nj-coral: #E07A5F;
  --nj-sand: #F2CC8F;
  --nj-rose: #C1666B;

  --nj-parchment: #FAFAF5;
  --nj-warm-white: #F7F3EB;
  --nj-mist: #E8E4DC;
  --nj-stone: #9C9587;
  --nj-charcoal: #3D3B37;

  --font-display: 'Playfair Display', Georgia, 'Times New Roman', serif;
  --font-body: 'Figtree', system-ui, -apple-system, 'Segoe UI', sans-serif;

  --nj-amber-text: #C1800B;
  --nj-green-text: #0E7C7B;
  --nj-red-text: #C1666B;

  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 16px;

  --shadow-sm: 0 1px 3px rgba(10,22,40,.06), 0 1px 2px rgba(10,22,40,.04);
  --shadow-md: 0 4px 14px rgba(10,22,40,.08), 0 2px 4px rgba(10,22,40,.04);
  --shadow-lg: 0 12px 40px rgba(10,22,40,.12), 0 4px 12px rgba(10,22,40,.06);

  --ease-expo: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
  --ease-editorial: cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

[data-bs-theme="dark"] {
  --nj-parchment: #0D1B2A;
  --nj-warm-white: #132744;
  --nj-mist: #1B3A5C;
  --nj-stone: #7B8794;
  --nj-charcoal: #E2DFD7;
  --nj-navy: #b8d4e3;
  --nj-deep: #4a7a9b;
  --nj-ocean: #5fa8d3;
}

/* ---------- Base ---------- */
body {
  font-family: var(--font-body);
  background: var(--nj-parchment);
  color: var(--nj-charcoal);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ---------- Paper Grain Texture ---------- */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9999;
  opacity: 0.025;
  background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='grain'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23grain)'/%3E%3C/svg%3E");
  background-repeat: repeat;
}

/* ---------- Navbar ---------- */
.navbar {
  background: linear-gradient(135deg, var(--nj-deep) 0%, var(--nj-navy) 40%, var(--nj-ocean) 100%) !important;
  border-bottom: 1px solid rgba(95,168,211,.15);
  box-shadow: 0 4px 24px rgba(10,22,40,.3);
  padding: .3rem 1.5rem !important;
  min-height: auto;
}

.navbar-brand {
  font-family: var(--font-display) !important;
  font-weight: 600 !important;
  font-size: 1.15rem !important;
  letter-spacing: .015em;
  color: #fff !important;
  gap: .45rem;
}

.navbar-brand svg { opacity: .85; }

.navbar .nav-link {
  font-family: var(--font-body);
  font-weight: 500;
  font-size: .76rem;
  color: rgba(255,255,255,.7) !important;
  padding: .5rem .8rem;
  border-radius: var(--radius-sm);
  transition: all .3s var(--ease-expo);
  position: relative;
  letter-spacing: .06em;
  text-transform: uppercase;
}

.navbar .nav-link:hover {
  color: #fff !important;
  background: rgba(255,255,255,.08);
}

.navbar .nav-link.active {
  color: #fff !important;
  background: rgba(95,168,211,.18) !important;
}

.navbar .nav-link.active::after {
  content: '';
  position: absolute;
  bottom: 2px;
  left: 50%;
  transform: translateX(-50%);
  width: 24px;
  height: 3px;
  background: var(--nj-coral);
  border-radius: 1px;
}

.navbar .nav-link svg {
  margin-right: .2rem;
  opacity: .65;
  transition: opacity .25s;
}
.navbar .nav-link:hover svg,
.navbar .nav-link.active svg { opacity: 1; }

/* ---------- Cards (Asymmetric Editorial) ---------- */
.card {
  background: #fff;
  border-top: 1px solid rgba(10,22,40,.06) !important;
  border-right: 1px solid rgba(10,22,40,.06) !important;
  border-bottom: 1px solid rgba(10,22,40,.06) !important;
  border-left: 3px solid var(--nj-ocean) !important;
  border-radius: 2px var(--radius-sm) var(--radius-sm) 2px !important;
  box-shadow: 0 1px 3px rgba(10,22,40,.04);
  transition: box-shadow .3s var(--ease-editorial), transform .3s var(--ease-editorial), border-left-color .3s var(--ease-editorial);
  overflow: hidden;
}

.card:hover {
  box-shadow: var(--shadow-md);
  border-left-color: var(--nj-blue) !important;
}
/* Skip transform on cards containing interactive widgets (plotly, leaflet, DT)
   — translateX shift disrupts hover/tooltip event coordinates */
.card:not(:has(.js-plotly-plot)):not(:has(.leaflet-container)):not(:has(.dataTable)):hover {
  transform: translateX(2px);
}

.card-header {
  font-family: var(--font-display) !important;
  font-weight: 600;
  font-size: .85rem;
  letter-spacing: .01em;
  border-bottom: 1px solid rgba(10,22,40,.05) !important;
  padding: .7rem 1.15rem !important;
  background: transparent !important;
  color: var(--nj-navy) !important;
}

.card-header.bg-primary {
  background: transparent !important;
  color: var(--nj-navy) !important;
  border-bottom-color: rgba(10,22,40,.05) !important;
}

.card-header.bg-primary .text-white { color: var(--nj-navy) !important; }

[data-bs-theme="dark"] .card {
  background: var(--nj-warm-white);
  border-color: rgba(255,255,255,.08) !important;
  border-left-color: var(--nj-sky) !important;
}
[data-bs-theme="dark"] .card-header {
  color: var(--nj-charcoal) !important;
  border-bottom-color: rgba(255,255,255,.06) !important;
}

/* ---------- Sidebar ---------- */
.sidebar {
  background: var(--nj-warm-white) !important;
  border-right: 1px solid var(--nj-mist) !important;
}

.sidebar .sidebar-title {
  font-family: var(--font-display) !important;
  font-weight: 600 !important;
  font-size: 1rem;
  color: var(--nj-navy);
}

.sidebar h6 {
  font-variant: small-caps;
  letter-spacing: 0.1em;
  border-bottom: 1px solid var(--nj-mist);
  padding-bottom: 0.35rem;
}

.sidebar .form-label,
.sidebar .control-label,
.sidebar label {
  font-size: .75rem !important;
  font-weight: 600 !important;
  text-transform: uppercase;
  letter-spacing: .05em;
  color: var(--nj-stone) !important;
}

.sidebar .form-check {
  margin-bottom: 0.35rem;
}

.sidebar .form-select,
.sidebar .form-control {
  border-radius: var(--radius-sm);
  border: 1px solid var(--nj-mist);
  font-size: .84rem;
  transition: border-color .2s, box-shadow .2s;
}

.sidebar .form-select:focus,
.sidebar .form-control:focus {
  border-color: var(--nj-blue);
  box-shadow: 0 0 0 3px rgba(224,122,95,.12);
}

/* ---------- Buttons ---------- */
.btn-primary {
  background: linear-gradient(135deg, var(--nj-ocean), var(--nj-blue)) !important;
  border: none !important;
  border-radius: var(--radius-sm) !important;
  font-weight: 600;
  font-size: .84rem;
  letter-spacing: .02em;
  padding: .55rem 1.1rem;
  transition: all .3s var(--ease-expo);
  box-shadow: 0 2px 8px rgba(27,73,101,.25);
}

.btn-primary:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(27,73,101,.35);
  filter: brightness(1.08);
}

.btn-outline-primary {
  border: 1.5px solid var(--nj-blue) !important;
  color: var(--nj-blue) !important;
  border-radius: var(--radius-sm) !important;
  font-weight: 600;
  font-size: .84rem;
  background: transparent !important;
  transition: all .3s var(--ease-expo);
}

.btn-outline-primary:hover {
  background: var(--nj-blue) !important;
  color: #fff !important;
}

.btn-outline-secondary {
  border: 1.5px solid var(--nj-mist) !important;
  color: var(--nj-stone) !important;
  border-radius: var(--radius-sm) !important;
}

/* ---------- Home Hero ---------- */
.home-hero {
  text-align: center;
  padding: 4rem 2rem 2.5rem;
  position: relative;
  overflow: hidden;
}

.home-hero::before {
  display: none;
}

@keyframes hero-drift {
  0%, 100% { transform: translate(0,0) rotate(0deg); }
  33% { transform: translate(2%,-1%) rotate(.4deg); }
  66% { transform: translate(-1.5%,1%) rotate(-.3deg); }
}

.home-hero h1 {
  font-family: var(--font-display) !important;
  font-weight: 800 !important;
  font-size: 3.8rem !important;
  color: var(--nj-navy) !important;
  margin-bottom: .5rem;
  position: relative;
  letter-spacing: -.02em;
  line-height: 1.1;
}

.home-hero h1::after {
  content: '';
  display: block;
  width: 80px;
  height: 2px;
  background: linear-gradient(90deg, var(--nj-coral), var(--nj-teal));
  margin: .85rem auto 0;
  border-radius: 2px;
}

.home-hero .subtitle {
  font-family: var(--font-display) !important;
  font-weight: 400 !important;
  font-style: italic;
  color: var(--nj-ocean) !important;
  font-size: 1.12rem !important;
  max-width: 600px;
  margin: 1.3rem auto .6rem !important;
  line-height: 1.7;
}

.home-hero .text-muted {
  font-size: .88rem !important;
  max-width: 580px;
  margin: 0 auto !important;
  line-height: 1.75;
  color: var(--nj-stone) !important;
}

/* ---------- NFF Triangle ---------- */
.nff-triangle-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1.2rem 1rem .6rem;
  position: relative;
}

/* Widget wrapper */
.nff-triangle-widget {
  position: relative;
  width: 100%;
  max-width: 440px;
}

/* Main SVG */
.nff-svg {
  width: 100%;
  height: auto;
  cursor: crosshair;
  filter: drop-shadow(0 4px 16px rgba(10,22,40,.08));
  user-select: none;
  -webkit-user-select: none;
}
.nff-svg.nff-dragging { cursor: grabbing; }

/* 3-colour gradient blobs */
.nff-gradient-bg polygon {
  transition: opacity .6s var(--ease-expo);
}
.nff-triangle-widget:hover .nff-gradient-bg polygon { opacity: 0.65; }

/* Triangle outline */
.nff-tri-outline {
  stroke: var(--nj-ocean);
  stroke-width: 1.5;
  opacity: .2;
  transition: opacity .4s;
}
.nff-triangle-widget:hover .nff-tri-outline { opacity: .3; }

/* Vertex glow rings */
.vertex-glow {
  fill: none;
  stroke: var(--nj-sky);
  stroke-width: 1;
  opacity: .25;
  animation: v-pulse 3.5s ease-in-out infinite;
}
@keyframes v-pulse {
  0%, 100% { opacity: .15; stroke-width: 1; }
  50%      { opacity: .45; stroke-width: 1.5; }
}

/* Vertices */
.nff-vertex {
  fill: var(--nj-ocean);
  transition: all .4s var(--ease-spring);
  cursor: pointer;
}
.nff-vertex:hover {
  fill: var(--nj-coral);
  r: 15;
  filter: drop-shadow(0 0 10px rgba(224,122,95,.45));
}

/* Vertex labels */
.vertex-label {
  font-family: var(--font-display);
  font-size: 13px;
  font-weight: 600;
  fill: var(--nj-navy);
  pointer-events: none;
  letter-spacing: .015em;
}

/* Edge relationship labels */
.edge-label {
  font-family: var(--font-body);
  font-size: 10.5px;
  font-weight: 600;
  fill: var(--nj-stone);
  pointer-events: none;
  letter-spacing: .06em;
  text-transform: uppercase;
}

/* ---- Narrative markers (diamonds) ---- */
.nff-narrative-marker {
  fill: var(--nj-navy);
  opacity: .35;
  transition: all .3s var(--ease-expo);
  pointer-events: none;
}
.nff-narrative-marker.active {
  fill: var(--nj-coral);
  opacity: .85;
  transform-origin: center;
}
/* Invisible hit target */
.nff-narrative-hit {
  cursor: pointer;
  opacity: 0;
}
.nff-narrative-hit:hover {
  opacity: 0.05;
  fill: var(--nj-coral);
}

/* ---- Position marker ---- */
.nff-position-marker {
  fill: #fff;
  stroke: var(--nj-ocean);
  stroke-width: 2.5;
  cursor: grab;
  filter: drop-shadow(0 2px 6px rgba(10,22,40,.25));
  transition: r .2s var(--ease-spring);
}
.nff-position-marker:hover { r: 10; }
.nff-dragging .nff-position-marker { cursor: grabbing; r: 10; }

.nff-position-ring {
  fill: none;
  stroke: var(--nj-ocean);
  stroke-width: 1.5;
  opacity: .2;
  stroke-dasharray: 3 3;
  cursor: grab;
  animation: ring-spin 12s linear infinite;
}
@keyframes ring-spin {
  to { stroke-dashoffset: -36; }
}

/* ---- Weight readout ---- */
.nff-weight-readout {
  display: flex;
  justify-content: center;
  gap: 1rem;
  padding: .5rem 0 .2rem;
  font-family: var(--font-body);
  font-size: .78rem;
  font-weight: 600;
  color: var(--nj-charcoal);
  letter-spacing: .01em;
}

.nff-weight {
  display: inline-flex;
  align-items: center;
  gap: .3rem;
}

.nff-w-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

/* ---- Vertex tooltip (simple) ---- */
.nff-tooltip {
  position: fixed;
  background: var(--nj-deep);
  color: rgba(255,255,255,.92);
  padding: 7px 14px;
  border-radius: var(--radius-sm);
  font-size: .74rem;
  font-family: var(--font-body);
  font-weight: 500;
  pointer-events: none;
  opacity: 0;
  transform: translateY(5px);
  transition: opacity .2s, transform .2s;
  z-index: 9999;
  max-width: 260px;
  line-height: 1.45;
  box-shadow: 0 6px 20px rgba(0,0,0,.25);
  letter-spacing: .01em;
}
.nff-tooltip.visible {
  opacity: 1;
  transform: translateY(0);
}

/* ---- Narrative tooltip (rich) ---- */
.nff-narrative-tooltip {
  position: fixed;
  background: var(--nj-deep);
  color: rgba(255,255,255,.92);
  padding: 12px 16px;
  border-radius: var(--radius-md);
  font-family: var(--font-body);
  pointer-events: none;
  opacity: 0;
  transform: translateY(6px);
  transition: opacity .25s, transform .25s var(--ease-expo);
  z-index: 9999;
  max-width: 300px;
  line-height: 1.5;
  box-shadow: 0 8px 28px rgba(0,0,0,.3);
}
.nff-narrative-tooltip.visible {
  opacity: 1;
  transform: translateY(0);
}
.nff-nt-name {
  font-family: var(--font-display);
  font-weight: 600;
  font-size: .9rem;
  margin-bottom: 2px;
  color: #fff;
}
.nff-nt-pos {
  font-size: .68rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .06em;
  color: var(--nj-sky);
  margin-bottom: 6px;
}
.nff-nt-desc {
  font-size: .78rem;
  font-weight: 400;
  line-height: 1.55;
  color: rgba(255,255,255,.8);
  margin-bottom: 6px;
}
.nff-nt-gov {
  font-size: .72rem;
  color: var(--nj-sky);
  border-top: 1px solid rgba(255,255,255,.1);
  padding-top: 5px;
}
.nff-nt-gov strong {
  color: rgba(255,255,255,.6);
  font-weight: 500;
}

/* ---- Dark mode adjustments ---- */
[data-bs-theme="dark"] .vertex-label { fill: var(--nj-charcoal); }
[data-bs-theme="dark"] .nff-tri-outline { stroke: var(--nj-sky); }
[data-bs-theme="dark"] .nff-narrative-marker { fill: var(--nj-sky); }
[data-bs-theme="dark"] .nff-position-marker {
  fill: var(--nj-warm-white);
  stroke: var(--nj-sky);
}
[data-bs-theme="dark"] .nff-weight-readout { color: var(--nj-charcoal); }
[data-bs-theme="dark"] .nff-gradient-bg polygon { opacity: 0.45; }
[data-bs-theme="dark"] .nff-triangle-widget:hover .nff-gradient-bg polygon { opacity: 0.55; }

/* ---------- Accordion (Home) ---------- */
.accordion {
  --bs-accordion-border-color: var(--nj-mist);
  --bs-accordion-border-radius: var(--radius-md);
}

.accordion-button {
  font-family: var(--font-body) !important;
  font-weight: 600;
  font-size: .86rem;
  color: var(--nj-navy) !important;
  letter-spacing: .01em;
  padding: .8rem 1.15rem;
}

.accordion-button:not(.collapsed) {
  background: rgba(42,111,151,.04) !important;
  color: var(--nj-ocean) !important;
  box-shadow: none !important;
}

.accordion-button:focus {
  box-shadow: 0 0 0 3px rgba(42,111,151,.1) !important;
}

.accordion-body {
  font-size: .87rem;
  line-height: 1.75;
  color: var(--nj-charcoal);
}

.accordion-item {
  border-color: var(--nj-mist) !important;
}

/* ---------- Value Boxes ---------- */
.bslib-value-box {
  border-radius: var(--radius-md) !important;
  transition: all .35s var(--ease-expo) !important;
  border: none !important;
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}

.bslib-value-box:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg) !important;
}

.bslib-value-box .value-box-title {
  font-family: var(--font-body) !important;
  font-weight: 700 !important;
  font-size: .76rem !important;
  text-transform: uppercase;
  letter-spacing: .06em;
}

.bslib-value-box .value-box-value {
  font-family: var(--font-display) !important;
  font-weight: 700 !important;
  font-size: 1.6rem !important;
}

/* ---------- Justice Scorecard ---------- */
.justice-card {
  border-left: 4px solid var(--nj-mist) !important;
  border-radius: var(--radius-md) !important;
  transition: all .3s var(--ease-expo);
}

.justice-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.justice-card.status-green { border-left-color: var(--nj-teal) !important; }
.justice-card.status-amber { border-left-color: var(--nj-sand) !important; }
.justice-card.status-red   { border-left-color: var(--nj-coral) !important; }

.justice-card h3 {
  font-family: var(--font-display) !important;
  font-weight: 700 !important;
  font-size: 2.8rem !important;
  color: var(--nj-navy);
  line-height: 1;
}

.pct-symbol {
  font-size: 1.4rem;
  font-weight: 600;
  opacity: 0.6;
}

.justice-progress {
  height: 4px;
  background: var(--nj-mist);
  border-radius: 2px;
  overflow: hidden;
  margin: 0.5rem 0;
}

.justice-progress::after {
  content: '';
  display: block;
  height: 100%;
  width: var(--score);
  border-radius: 2px;
  transition: width 0.8s var(--ease-expo);
}

.status-green .justice-progress::after {
  background: linear-gradient(90deg, var(--nj-teal), var(--nj-seafoam));
}
.status-amber .justice-progress::after {
  background: linear-gradient(90deg, var(--nj-sand), #E0B06B);
}
.status-red .justice-progress::after {
  background: linear-gradient(90deg, var(--nj-coral), var(--nj-rose));
}

/* ---------- Traffic Lights ---------- */
.traffic-light {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 8px;
  vertical-align: middle;
  position: relative;
  flex-shrink: 0;
}

.traffic-light::after {
  content: '';
  position: absolute;
  top: -3px;
  left: -3px;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  opacity: .25;
}

.traffic-light.green {
  background: var(--nj-teal);
  box-shadow: 0 0 6px rgba(14,124,123,.35);
}
.traffic-light.green::after { border: 1.5px solid var(--nj-teal); }

.traffic-light.amber {
  background: var(--nj-sand);
  box-shadow: 0 0 6px rgba(242,204,143,.4);
}
.traffic-light.amber::after { border: 1.5px solid var(--nj-sand); }

.traffic-light.red {
  background: var(--nj-coral);
  box-shadow: 0 0 6px rgba(224,122,95,.35);
}
.traffic-light.red::after { border: 1.5px solid var(--nj-coral); }

/* ---------- DataTables (Minimal Rule) ---------- */
.dataTables_wrapper { font-size: .84rem; }

.dataTables_wrapper .dataTables_filter input {
  border-radius: var(--radius-sm);
  border: 1px solid var(--nj-mist);
  padding: .4rem .75rem;
  font-size: .84rem;
  transition: border-color .2s, box-shadow .2s;
}

.dataTables_wrapper .dataTables_filter input:focus {
  border-color: var(--nj-blue);
  box-shadow: 0 0 0 3px rgba(42,111,151,.1);
  outline: none;
}

table.dataTable thead th {
  font-family: var(--font-body) !important;
  font-weight: 700 !important;
  font-size: .7rem;
  text-transform: uppercase;
  letter-spacing: .08em;
  color: var(--nj-navy);
  border-bottom: 2px solid var(--nj-ocean) !important;
  padding: .75rem 1rem !important;
  background: transparent !important;
}

table.dataTable tbody td {
  padding: .75rem 1rem !important;
  vertical-align: middle;
  border-bottom: 1px solid rgba(10,22,40,.06) !important;
  font-size: .84rem;
  background: transparent !important;
}

table.dataTable tbody tr {
  background: transparent !important;
}

table.dataTable tbody tr:hover {
  background: rgba(42,111,151,.02) !important;
}

table.dataTable tbody tr:nth-child(odd),
table.dataTable tbody tr:nth-child(even) {
  background: transparent !important;
}

/* ---------- Nav Tabs (Scenarios, Governance) ---------- */
.nav-tabs {
  border-bottom: 2px solid var(--nj-mist) !important;
}

.nav-tabs .nav-link {
  font-family: var(--font-body) !important;
  font-weight: 600;
  font-size: .82rem;
  color: var(--nj-stone) !important;
  padding: .6rem 1.15rem !important;
  border: none !important;
  border-bottom: 2px solid transparent !important;
  margin-bottom: -2px;
  transition: all .25s;
  letter-spacing: .01em;
}

.nav-tabs .nav-link:hover {
  color: var(--nj-ocean) !important;
  border-bottom-color: rgba(42,111,151,.25) !important;
}

.nav-tabs .nav-link.active {
  color: var(--nj-ocean) !important;
  border-bottom-color: var(--nj-ocean) !important;
  background: transparent !important;
}

/* ---------- Sliders ---------- */
.irs--shiny .irs-bar {
  background: linear-gradient(90deg, var(--nj-ocean), var(--nj-blue)) !important;
  border: none !important;
}

.irs--shiny .irs-handle {
  background: var(--nj-blue) !important;
  border: 2px solid #fff !important;
  box-shadow: 0 2px 8px rgba(42,111,151,.35) !important;
  width: 18px !important;
  height: 18px !important;
  top: 23px !important;
  border-radius: 50% !important;
  cursor: grab;
}

.irs--shiny .irs-handle:active { cursor: grabbing; }

.irs--shiny .irs-line {
  background: var(--nj-mist) !important;
  border-radius: 4px !important;
}

.irs--shiny .irs-single {
  background: var(--nj-ocean) !important;
  border-radius: var(--radius-sm) !important;
  font-size: .72rem;
  font-weight: 600;
  padding: 1px 6px !important;
}

.irs--shiny .irs-min,
.irs--shiny .irs-max {
  color: var(--nj-stone);
  font-size: .68rem;
}

.irs--shiny .irs-grid-text {
  font-size: .65rem;
  color: var(--nj-stone);
}

/* ---------- Headings ---------- */
h4, h5 {
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 1.3rem;
  color: var(--nj-navy);
  letter-spacing: .01em;
}

h6 {
  font-family: var(--font-body);
  font-weight: 700;
  font-size: .76rem;
  text-transform: uppercase;
  letter-spacing: .06em;
  color: var(--nj-stone);
}

/* ---------- Alerts ---------- */
.alert {
  border: none !important;
  border-radius: var(--radius-md) !important;
  font-size: .87rem;
  font-weight: 500;
}

.alert-warning {
  background: rgba(242,204,143,.18) !important;
  color: var(--nj-charcoal) !important;
  border-left: 3px solid var(--nj-sand) !important;
}

.alert-success {
  background: rgba(14,124,123,.07) !important;
  color: var(--nj-charcoal) !important;
  border-left: 3px solid var(--nj-teal) !important;
}

.alert-danger {
  background: rgba(224,122,95,.07) !important;
  color: var(--nj-charcoal) !important;
  border-left: 3px solid var(--nj-coral) !important;
}

/* ---------- Scrollbar ---------- */
::-webkit-scrollbar { width: 7px; height: 7px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb {
  background: var(--nj-mist);
  border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover { background: var(--nj-stone); }

/* ---------- Page Animations (Staggered Diagonal) ---------- */
@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateX(-8px) translateY(10px); }
  to   { opacity: 1; transform: translateX(0) translateY(0); }
}

.tab-pane > .bslib-gap-spacing > .card,
.tab-pane > .bslib-gap-spacing > .bslib-value-box,
.tab-pane > .bslib-gap-spacing > .bslib-layout-columns,
.tab-pane > .bslib-gap-spacing > h5 {
  animation: fadeSlideIn .45s var(--ease-editorial) both;
}

.tab-pane > .bslib-gap-spacing > *:nth-child(1) { animation-delay: 0s; }
.tab-pane > .bslib-gap-spacing > *:nth-child(2) { animation-delay: .06s; }
.tab-pane > .bslib-gap-spacing > *:nth-child(3) { animation-delay: .12s; }
.tab-pane > .bslib-gap-spacing > *:nth-child(4) { animation-delay: .18s; }
.tab-pane > .bslib-gap-spacing > *:nth-child(5) { animation-delay: .24s; }
.tab-pane > .bslib-gap-spacing > *:nth-child(6) { animation-delay: .30s; }

/* ---------- Section heading deco ---------- */
h4.text-center {
  font-size: 1.3rem !important;
  position: relative;
}

h4.text-center::after {
  content: '';
  display: block;
  width: 48px;
  height: 2px;
  background: linear-gradient(90deg, var(--nj-coral), var(--nj-teal));
  margin: .45rem auto 0;
  border-radius: 1px;
}

/* ---------- Misc ---------- */
hr {
  border-color: var(--nj-mist) !important;
  opacity: .45;
}

.text-muted { color: var(--nj-stone) !important; }

.badge.bg-warning {
  background: var(--nj-sand) !important;
  color: var(--nj-charcoal) !important;
  font-weight: 600;
  font-size: .68rem;
  letter-spacing: .03em;
}

.leaflet-container { border-radius: var(--radius-sm); }

/* Plotly modebar subtle */
.modebar { opacity: .4; transition: opacity .3s; }
.modebar:hover { opacity: 1; }

/* Download btn icon */
.btn .bi { margin-right: .3rem; }

/* Picker input */
.bootstrap-select .dropdown-toggle {
  border-radius: var(--radius-sm) !important;
  border: 1px solid var(--nj-mist) !important;
  font-size: .84rem !important;
}

/* ---------- Info Dropdown ---------- */
.navbar .dropdown-menu {
  background: var(--nj-deep) !important;
  border: 1px solid rgba(95,168,211,.15);
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-lg);
  padding: .35rem 0;
  min-width: 200px;
}

.navbar .dropdown-menu .nav-item a,
.navbar .dropdown-menu .dropdown-item {
  color: rgba(255,255,255,.75) !important;
  font-size: .82rem;
  font-weight: 500;
  padding: .5rem 1rem;
  transition: all .2s var(--ease-expo);
  text-decoration: none;
  display: block;
}

.navbar .dropdown-menu .nav-item a:hover,
.navbar .dropdown-menu .dropdown-item:hover {
  color: #fff !important;
  background: rgba(95,168,211,.15);
}

.navbar .dropdown-menu .nav-item a svg,
.navbar .dropdown-menu .dropdown-item svg {
  opacity: .6;
  margin-right: .35rem;
  transition: opacity .2s;
}

.navbar .dropdown-menu .nav-item a:hover svg,
.navbar .dropdown-menu .dropdown-item:hover svg {
  opacity: 1;
}

/* ---------- Modals ---------- */
.modal-header {
  background: linear-gradient(135deg, var(--nj-ocean), var(--nj-blue)) !important;
  color: #fff !important;
  border-bottom: none !important;
  padding: .9rem 1.25rem;
}

.modal-header .modal-title {
  font-family: var(--font-display) !important;
  font-weight: 600;
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  gap: .4rem;
}

.modal-header .modal-title svg {
  opacity: .85;
}

.modal-header .btn-close {
  filter: invert(1);
  opacity: .65;
}

.modal-header .btn-close:hover {
  opacity: 1;
}

.modal-content {
  border: none !important;
  border-radius: var(--radius-md) !important;
  box-shadow: var(--shadow-lg);
  overflow: hidden;
}

.modal-body {
  padding: 1.25rem;
}

.modal-body .accordion {
  --bs-accordion-border-color: var(--nj-mist);
}

.modal-body .accordion-panel {
  margin-bottom: 0;
}

.modal-body .accordion-body {
  font-size: .85rem;
  line-height: 1.7;
}

.modal-body .accordion-body h6 {
  margin-top: .75rem;
  margin-bottom: .35rem;
}

.modal-body .accordion-body h6:first-child {
  margin-top: 0;
}

.modal-body .table {
  font-size: .82rem;
}

.modal-body .table th {
  font-size: .72rem;
  text-transform: uppercase;
  letter-spacing: .05em;
  color: var(--nj-navy);
  border-bottom: 2px solid var(--nj-ocean);
}

.modal-footer {
  border-top: 1px solid var(--nj-mist) !important;
  padding: .65rem 1.25rem;
}

[data-bs-theme="dark"] .modal-content {
  background: var(--nj-warm-white);
}

[data-bs-theme="dark"] .modal-header {
  background: linear-gradient(135deg, var(--nj-deep), var(--nj-navy)) !important;
}

/* Dark mode toggle */
.bslib-dark-mode {
  opacity: .7;
  transition: opacity .25s;
}
.bslib-dark-mode:hover { opacity: 1; }

/* Verbatim text (weight summary) */
pre, .shiny-text-output {
  font-family: var(--font-body) !important;
  font-size: .78rem;
  background: rgba(42,111,151,.04);
  border: 1px solid var(--nj-mist);
  border-radius: var(--radius-sm);
  padding: .45rem .7rem;
  color: var(--nj-ocean);
  font-weight: 600;
}

/* Stakeholder list items (DT-based, styled via DT options) */

/* GBF compliance inline items */
.d-flex.align-items-center.mb-2 strong {
  font-family: var(--font-body);
  color: var(--nj-navy);
  font-size: .84rem;
}

.d-flex.align-items-center.mb-2 .text-muted {
  font-size: .82rem;
}

/* Card footer */
.card-footer {
  background: transparent !important;
  border-top: 1px solid rgba(10,22,40,.04) !important;
  font-size: .78rem;
  color: var(--nj-stone);
}

/* ── Narratives Module ── */

.narratives-hero {
  text-align: center;
  padding: 1.5rem 1rem 1rem;
}
.narratives-hero h2 {
  font-family: var(--font-display, "Playfair Display", serif);
  color: var(--nj-navy, #1B4965);
  font-weight: 700;
  font-size: 2.2rem;
}

.overflow-auto h6 {
  color: var(--nj-navy, #1B4965);
  font-weight: 600;
}

.nff-nt-hint {
  font-size: 0.72rem;
  color: #999;
  margin-top: 0.3rem;
  font-style: italic;
}

/* Dark mode */
[data-bs-theme="dark"] .narratives-hero h2 {
  color: #e0ddd8;
}
[data-bs-theme="dark"] .overflow-auto h6 {
  color: #b8d4e3;
}

/* ── Narrative Triangle (read-only) ── */

.nff-narrative-mode .nff-svg {
  cursor: default;
  max-width: 320px;
  margin: 0 auto;
  display: block;
}

.nff-narrative-mode .nff-narrative-marker.narrative-active {
  fill: var(--nj-teal);
  transform-origin: center;
  animation: narrative-pulse 1.5s ease-in-out infinite;
}

@keyframes narrative-pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50%      { opacity: 0.8; transform: scale(1.45); }
}

[data-bs-theme="dark"] .nff-narrative-mode .nff-narrative-marker.narrative-active {
  fill: var(--nj-sky);
}

/* ── Stakeholders Module ── */

.stakeholders-hero {
  text-align: center;
  padding: 1.5rem 1rem 1rem;
}
.stakeholders-hero h2 {
  font-family: var(--font-display, "Playfair Display", serif);
  color: var(--nj-navy, #1B4965);
  font-weight: 700;
  font-size: 2.2rem;
}
[data-bs-theme="dark"] .stakeholders-hero h2 {
  color: #e0ddd8;
}

.nff-stakeholder-mode .nff-position-marker {
  opacity: 0.5;
}
.nff-stakeholder-mode .nff-position-ring {
  opacity: 0.3;
}

.stakeholder-dot {
  transition: opacity 0.2s;
}
.stakeholder-dot:hover {
  opacity: 1 !important;
  r: 7;
}
.stakeholder-label {
  pointer-events: none;
}

/* Stakeholders dark mode: reuses .narratives-hero h2 rule above */
[data-bs-theme="dark"] .stakeholder-label {
  opacity: 0.85;
}

/* ── Pathways Module ── */

.pathways-hero {
  text-align: center;
  padding: 1.5rem 1rem 1rem;
}
.pathways-hero h2 {
  font-family: var(--font-display, "Playfair Display", serif);
  color: var(--nj-navy, #1B4965);
  font-weight: 700;
  font-size: 2.2rem;
}

.pathway-line {
  transition: opacity 0.3s;
}
.pathway-anim-dot {
  transition: cx 0.15s ease-out, cy 0.15s ease-out;
}

[data-bs-theme="dark"] .pathways-hero h2 {
  color: #e0ddd8;
}
[data-bs-theme="dark"] .pathway-line {
  stroke: #b8d4e3;
}
[data-bs-theme="dark"] .pathway-label {
  fill: #e0ddd8 !important;
}

/* ── Scenario Loading Spinners ── */

.scenario-output-wrap {
  position: relative;
  min-height: 250px;
}

/* Spinner overlay — visible by default (initial empty state) */
.scenario-spinner {
  display: flex;
  position: absolute;
  inset: 0;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(250, 250, 245, 0.92);
  z-index: 10;
  border-radius: var(--radius-sm);
  gap: 0.6rem;
}

/* Hide once plotly has rendered its chart */
.scenario-output-wrap:has(.js-plotly-plot) > .scenario-spinner {
  display: none;
}

/* Hide once shiny-html-output has content (GBF compliance) */
.scenario-output-wrap:has(.shiny-html-output:not(:empty)) > .scenario-spinner {
  display: none;
}

/* Show again when any child output is recalculating */
.scenario-output-wrap:has(.recalculating) > .scenario-spinner {
  display: flex;
}

/* Ocean-themed spinning ring */
.scenario-spinner-ring {
  width: 44px;
  height: 44px;
  border: 3px solid var(--nj-mist);
  border-top-color: var(--nj-ocean);
  border-right-color: var(--nj-teal);
  border-radius: 50%;
  animation: scenario-spin 0.9s linear infinite;
}

@keyframes scenario-spin {
  to { transform: rotate(360deg); }
}

.scenario-spinner-text {
  margin: 0;
  font-family: var(--font-body);
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--nj-ocean);
  letter-spacing: 0.01em;
}

/* Dark mode */
[data-bs-theme="dark"] .scenario-spinner {
  background: rgba(13, 27, 42, 0.92);
}

[data-bs-theme="dark"] .scenario-spinner-ring {
  border-color: var(--nj-mist);
  border-top-color: var(--nj-sky);
  border-right-color: var(--nj-teal);
}

[data-bs-theme="dark"] .scenario-spinner-text {
  color: var(--nj-sky);
}

/* ---------- Dark Mode Refinements ---------- */
[data-bs-theme="dark"] body::after {
  opacity: 0.015;
  filter: invert(1);
}

[data-bs-theme="dark"] table.dataTable tbody td {
  border-bottom-color: rgba(255,255,255,.06) !important;
}

[data-bs-theme="dark"] table.dataTable thead th {
  border-bottom-color: rgba(255,255,255,.12) !important;
}

[data-bs-theme="dark"] .justice-card h3 {
  color: var(--nj-charcoal);
}

/* ── Responsive breakpoints ── */
@media (max-width: 768px) {
  .home-hero h1 { font-size: 1.8rem !important; }
  .home-hero .subtitle { font-size: 0.95rem !important; }
  .narratives-hero h2,
  .stakeholders-hero h2,
  .pathways-hero h2 { font-size: 1.5rem !important; }
  .navbar { padding: 0.3rem 0.75rem !important; }
  .navbar .nav-link { font-size: 0.72rem !important; padding: 0.4rem 0.5rem !important; }
}

/* ── Reduced motion for accessibility (WCAG 2.1 AA §2.3.3) ── */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
